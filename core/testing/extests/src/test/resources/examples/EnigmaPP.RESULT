["class Purse\npublic static  CardId \u003d CardId\nprivate  balance:nat :\u003d (undefined)\nprivate  cardNo:CardId :\u003d (undefined)\npublic  IncreaseBal(nat) (nat \u003d\u003d\u003e ())\n\tIncreaseBal(nat)(sum) \u003d\u003d\nbalance :\u003d (balance + sum)\npublic  DecreaseBal(nat) (nat \u003d\u003d\u003e ())\n\tDecreaseBal(nat)(sum) \u003d\u003d\nbalance :\u003d (balance - sum)\n\tpre (sum \u003c\u003d balance)\npublic  GetBalance() (() \u003d\u003d\u003e nat)\n\tGetBalance()() \u003d\u003d\nreturn (balance)\npublic  GetCardNo() (() \u003d\u003d\u003e CardId)\n\tGetCardNo()() \u003d\u003d\nreturn (cardNo)\npublic  Purse(CardId, nat) (CardId * nat \u003d\u003d\u003e Purse)\n\tPurse(CardId, nat)(newId, startbal) \u003d\u003d\n(\n\ncardNo :\u003d newId;\nbalance :\u003d startbal\n)\nend Purse\n","class System\nprivate  Purses:map (CardId) to (Purse) :\u003d (undefined)\nprivate  inv(forall p in set (dom Purses) \u0026 ((Purses(p).GetCardNo)() \u003d p))\nprivate  Log:seq of (Transaction) :\u003d []\npublic static  Transaction \u003d Transaction\npublic  Transfer(CardId, CardId, nat) (CardId * CardId * nat \u003d\u003d\u003e ())\n\tTransfer(CardId, CardId, nat)(fromId, toId, sum) \u003d\u003d\n(\n\nPurses(fromId).DecreaseBal(sum);\nPurses(toId).IncreaseBal(sum)\n)\n\tpre (({fromId, toId} subset (dom Purses)) and ((fromId \u003c\u003e toId) and ((Purses(fromId).GetBalance)() \u003e\u003d sum)))\npublic  System(set of (Purse)) (set of (Purse) \u003d\u003d\u003e System)\n\tSystem(set of (Purse))(PurseSet) \u003d\u003d\nPurses :\u003d {(p.GetCardNo)() |-\u003e p | p in set PurseSet}\n\tpre (forall p, q in set PurseSet \u0026 ((p \u003c\u003e q) \u003d\u003e ((p.GetCardNo)() \u003c\u003e (q.GetCardNo)())))\npublic  TotalTransferred() (() \u003d\u003d\u003e nat)\n\tTotalTransferred()() \u003d\u003d\nreturn (TotalSum(Log))\nprivate  private TotalSum: (seq of (Transaction) -\u003e nat)\n\tTotalSum(tseq) \u003d\u003d\n(if (tseq \u003d [])\nthen 0\nelse let tx:Transaction \u003d (hd tseq) in ((tx.sum) + TotalSum((tl tseq))))\nprivate  private Len: (seq of (Transaction) -\u003e nat)\n\tLen(l) \u003d\u003d\n(len l)\nend System\n"]