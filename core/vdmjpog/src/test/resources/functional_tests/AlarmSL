-- TCErrors: WARNING:5008:11,25 WARNING:5008:18,11 WARNING:5008:54,19 WARNING:5008:66,28 WARNING:5000:47,3 WARNING:5000:65,1 WARNING:5000:116,1 WARNING:5000:121,3 WARNING:5000:131,3 PROOFOBLIGATION: UGxhbnQsMCwoZm9yYWxsIG1rX1BsYW50KHNjaGVkdWxlLCBhbGFybXMpOlBsYW50ICYKICAoZm9yYWxsIGEgaW4gc2V0IGFsYXJtcyAmCiAgICAoZm9yYWxsIHBlcmkgaW4gc2V0IChkb20gc2NoZWR1bGUpICYKICAgICAgcGVyaSBpbiBzZXQgZG9tIHNjaGVkdWxlKSkpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: TnVtYmVyT2ZFeHBlcnRzLDAsKGZvcmFsbCBwZXJpOlBlcmlvZCwgcGxhbnQ6UGxhbnQgJiAocGVyaSBpbiBzZXQgKGRvbSAocGxhbnQuc2NoZWR1bGUpKSkgPT4KICBwZXJpIGluIHNldCBkb20gKHBsYW50LnNjaGVkdWxlKSkKLG1hcCBhcHBseSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: RXhwZXJ0SXNPbkR1dHksMCwoZm9yYWxsIGV4OkV4cGVydCwgbWtfUGxhbnQoc2NoLCAtKTpQbGFudCAmCiAgKGZvcmFsbCBwZXJpIGluIHNldCAoZG9tIHNjaCkgJgogICAgcGVyaSBpbiBzZXQgZG9tIHNjaCkpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RXhwZXJ0VG9QYWdlLDAsKCgocGVyaSBpbiBzZXQgKGRvbSAocGxhbnQuc2NoZWR1bGUpKSkgYW5kIChhIGluIHNldCAocGxhbnQuYWxhcm1zKSkpID0+IGZvcmFsbCByOkV4cGVydCAmIAogIHBlcmkgaW4gc2V0IGRvbSAocGxhbnQuc2NoZWR1bGUpKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RXhwZXJ0VG9QYWdlLDAsKGZvcmFsbCBhOkFsYXJtLCBwZXJpOlBlcmlvZCwgcGxhbnQ6UGxhbnQgJgogIHByZV9FeHBlcnRUb1BhZ2UoYSwgcGVyaSwgcGxhbnQpID0+IGV4aXN0cyByOkV4cGVydCAmIHBvc3RfRXhwZXJ0VG9QYWdlKGEsIHBlcmksIHBsYW50LCByKSkKLGZ1bmN0aW9uIHNhdGlzZmlhYmlsaXR5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: Q2hhbmdlRXhwZXJ0LDAsKGZvcmFsbCBta19QbGFudChwbGFuLCBhbGFybXMpOlBsYW50LCBleDE6RXhwZXJ0LCBleDI6RXhwZXJ0LCBwZXJpOlBlcmlvZCAmCiAgcGVyaSBpbiBzZXQgZG9tIHBsYW4pCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: Q2hhbmdlRXhwZXJ0LDAsKGZvcmFsbCBta19QbGFudChwbGFuLCBhbGFybXMpOlBsYW50LCBleDE6RXhwZXJ0LCBleDI6RXhwZXJ0LCBwZXJpOlBlcmlvZCAmCiAgaW52X1NjaGVkdWxlKChwbGFuICsrIHtwZXJpIHwtPiAoKHBsYW4ocGVyaSkgXCB7ZXgxfSkgdW5pb24ge2V4Mn0pfSkpIGFuZCAoaXNfKChwbGFuICsrIHtwZXJpIHwtPiAoKHBsYW4ocGVyaSkgXCB7ZXgxfSkgdW5pb24ge2V4Mn0pfSksIG1hcCAoUGVyaW9kKSB0byAoc2V0IG9mIChFeHBlcnQpKSkpKQosc3VidHlwZSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: Q2hhbmdlRXhwZXJ0LDAsKGZvcmFsbCBta19QbGFudChwbGFuLCBhbGFybXMpOlBsYW50LCBleDE6RXhwZXJ0LCBleDI6RXhwZXJ0LCBwZXJpOlBlcmlvZCAmCiAgaW52X1BsYW50KG1rX1BsYW50KChwbGFuICsrIHtwZXJpIHwtPiAoKHBsYW4ocGVyaSkgXCB7ZXgxfSkgdW5pb24ge2V4Mn0pfSksIGFsYXJtcykpIGFuZCAoaW52X1NjaGVkdWxlKChwbGFuICsrIHtwZXJpIHwtPiAoKHBsYW4ocGVyaSkgXCB7ZXgxfSkgdW5pb24ge2V4Mn0pfSkpIGFuZCAoaXNfKChwbGFuICsrIHtwZXJpIHwtPiAoKHBsYW4ocGVyaSkgXCB7ZXgxfSkgdW5pb24ge2V4Mn0pfSksIG1hcCAoUGVyaW9kKSB0byAoc2V0IG9mIChFeHBlcnQpKSkpKSkKLHN1YnR5cGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: ZTEsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQxLCB7PEVsZWM+fSkpCixzdWJ0eXBlLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: ZTIsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQyLCB7PE1lY2g+LCA8Q2hlbT59KSkKLHN1YnR5cGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: ZTMsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQzLCB7PEJpbz4sIDxDaGVtPiwgPEVsZWM+fSkpCixzdWJ0eXBlLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: ZTQsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQ0LCB7PEJpbz59KSkKLHN1YnR5cGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: ZTUsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQ1LCB7PENoZW0+LCA8QmlvPn0pKQosc3VidHlwZSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: ZTYsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQ2LCB7PEVsZWM+LCA8Q2hlbT4sIDxCaW8+LCA8TWVjaD59KSkKLHN1YnR5cGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: ZTcsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQ3LCB7PEVsZWM+LCA8TWVjaD59KSkKLHN1YnR5cGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: ZTgsMCxpbnZfRXhwZXJ0KG1rX0V4cGVydChlaWQ4LCB7PE1lY2g+LCA8QmlvPn0pKQosc3VidHlwZSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: cywwLGZvcmFsbCBtMSwgbTIgaW4gc2V0IHt7cDEgfC0+IHtlNywgZTUsIGUxfX0sIHtwMiB8LT4ge2U2fX0sIHtwMyB8LT4ge2UxLCBlMywgZTh9fSwge3A0IHwtPiB7ZTZ9fX0gJgogIGZvcmFsbCBkMyBpbiBzZXQgZG9tIG0xLCBkNCBpbiBzZXQgZG9tIG0yICYKICAgIGQzID0gZDQgPT4gbTEoZDMpID0gbTIoZDQpCixtYXAgc2VxdWVuY2UgY29tcGF0aWJsZSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: cGxhbnQxLDAsaW52X1NjaGVkdWxlKHMpIGFuZCAoaXNfKHMsIG1hcCAoUGVyaW9kKSB0byAoc2V0IG9mIChFeHBlcnQpKSkpCixzdWJ0eXBlLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: cGxhbnQxLDAsaW52X1BsYW50KG1rX1BsYW50KHMsIHthMSwgYTIsIGEzfSkpIGFuZCAoaW52X1NjaGVkdWxlKHMpIGFuZCAoaXNfKHMsIG1hcCAoUGVyaW9kKSB0byAoc2V0IG9mIChFeHBlcnQpKSkpKQosc3VidHlwZSxudWxsLFVucHJvdmVkLA==



--alarm.vdmsl

types

  Plant :: schedule : Schedule
           alarms   : set of Alarm
  inv mk_Plant(schedule,alarms) ==
        forall a in set alarms &
	   forall peri in set dom schedule &
	     QualificationOK(schedule(peri),a.quali);
	     
  Schedule = map Period to set of Expert
inv sch ==
   forall exs in set rng sch &
          exs <> {} and
          forall ex1, ex2 in set exs &
                 ex1 <> ex2 => ex1.expertid <> ex2.expertid;

  Period = token;

  Expert :: expertid : ExpertId
            quali    : set of Qualification
  inv ex == ex.quali <> {};

  ExpertId = token;

  Qualification = <Elec> | <Mech> | <Bio> | <Chem>;
	   
  Alarm :: alarmtext : seq of char
           quali     : Qualification

functions

  NumberOfExperts: Period * Plant -> nat
  NumberOfExperts(peri,plant) ==
    card plant.schedule(peri)
  pre peri in set dom plant.schedule;

  ExpertIsOnDuty: Expert * Plant -> set of Period
  ExpertIsOnDuty(ex,mk_Plant(sch,-)) ==
    {peri| peri in set dom sch & ex in set sch(peri)};

  ExpertToPage(a:Alarm,peri:Period,plant:Plant) r: Expert
  pre peri in set dom plant.schedule and
      a in set plant.alarms
  post r in set plant.schedule(peri) and
       a.quali in set r.quali;

  QualificationOK: set of Expert * Qualification -> bool
  QualificationOK(exs,reqquali) ==
    exists ex in set exs & reqquali in set ex.quali

  


--changeexpert.vdmsl

functions

-- this function is NOT correct. Why not?
ChangeExpert: Plant * Expert * Expert * Period -> Plant
ChangeExpert(mk_Plant(plan,alarms),ex1,ex2,peri) ==
  mk_Plant(plan ++ {peri |-> plan(peri)\{ex1} union {ex2}},alarms)


--testalarm.vdmsl

values
 
  p1:Period = mk_token("Monday day");
  p2:Period = mk_token("Monday night");
  p3:Period = mk_token("Tuesday day");
  p4:Period = mk_token("Tuesday night");
  p5:Period = mk_token("Wednesday day");
  ps : set of Period = {p1,p2,p3,p4,p5};

  eid1:ExpertId = mk_token(134);
  eid2:ExpertId = mk_token(145);
  eid3:ExpertId = mk_token(154);
  eid4:ExpertId = mk_token(165);
  eid5:ExpertId = mk_token(169);
  eid6:ExpertId = mk_token(174);
  eid7:ExpertId = mk_token(181);
  eid8:ExpertId = mk_token(190);
  
  e1:Expert = mk_Expert(eid1,{<Elec>});
  e2:Expert = mk_Expert(eid2,{<Mech>,<Chem>});
  e3:Expert = mk_Expert(eid3,{<Bio>,<Chem>,<Elec>});
  e4:Expert = mk_Expert(eid4,{<Bio>});
  e5:Expert = mk_Expert(eid5,{<Chem>,<Bio>});
  e6:Expert = mk_Expert(eid6,{<Elec>,<Chem>,<Bio>,<Mech>});
  e7:Expert = mk_Expert(eid7,{<Elec>,<Mech>});
  e8:Expert = mk_Expert(eid8,{<Mech>,<Bio>});
  exs : set of Expert = {e1,e2,e3,e4,e5,e6,e7,e8};

  s: map Period to set of Expert
     = {p1 |-> {e7,e5,e1},
        p2 |-> {e6},
        p3 |-> {e1,e3,e8},
        p4 |-> {e6}};

  a1:Alarm = mk_Alarm("Power supply missing",<Elec>);
  a2:Alarm = mk_Alarm("Tank overflow",<Mech>);
  a3:Alarm = mk_Alarm("CO2 detected",<Chem>);
  a4:Alarm = mk_Alarm("Biological attack",<Bio>);
  alarms: set of Alarm = {a1,a2,a3,a4};
  
  plant1 : Plant = mk_Plant(s,{a1,a2,a3})
  
operations

Run: Expert ==> set of Period
Run(e) == return ExpertIsOnDuty(e, plant1);

traces 

  Test1: let a in set alarms
         in
           let p in set ps 
           in
             (NumberOfExperts(p,plant1);
              pre_ExpertToPage(a,p,plant1);
              let ex in set exs
              in
                post_ExpertToPage(a,p,plant1,ex))
               
  Test2: let ex in set exs
         in
           ExpertIsOnDuty(ex,plant1)
 