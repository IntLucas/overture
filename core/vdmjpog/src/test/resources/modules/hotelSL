-- TCErrors: WARNING:5010:19,7 WARNING:5000:36,1 WARNING:5000:54,1 WARNING:5000:67,1 WARNING:5000:85,1 WARNING:5000:95,1 WARNING:5000:103,1 WARNING:5000:110,1 PROOFOBLIGATION: Q2hlY2tJbiwgbmV3X2MsMCwoZm9yYWxsIG5ld19rOktleSAmCiAgKChuZXdfayBub3QgaW4gc2V0IChkZXNrfi5pc3N1ZWQpKSA9PgogICAgciBpbiBzZXQgZG9tIChkZXNrfi5wcmV2KSkpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: Q2hlY2tJbiwwLChmb3JhbGwgbmV3X2s6S2V5ICYKICAoKG5ld19rIG5vdCBpbiBzZXQgKGRlc2t+Lmlzc3VlZCkpID0+CiAgICAobGV0IG5ld19jOkNhcmQgPSBta19DYXJkKChkZXNrfi5wcmV2KShyKSwgbmV3X2spIGluCiAgICAgICgoKGRlc2suaXNzdWVkKSA9ICgoZGVza34uaXNzdWVkKSB1bmlvbiB7bmV3X2t9KSkgPT4KICAgICAgICAoKChkZXNrLnByZXYpID0gKChkZXNrfi5wcmV2KSArKyB7ciB8LT4gbmV3X2t9KSkgPT4KICAgICAgICAgICgoZyBpbiBzZXQgKGRvbSBndWVzdHN+KSkgPT4KICAgICAgICAgICAgZyBpbiBzZXQgZG9tIGd1ZXN0c34pKSkpKSkKLG1hcCBhcHBseSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: Q2hlY2tJbiwwLChmb3JhbGwgbmV3X2s6S2V5ICYKICAoKG5ld19rIG5vdCBpbiBzZXQgKGRlc2t+Lmlzc3VlZCkpID0+CiAgICAobGV0IG5ld19jOkNhcmQgPSBta19DYXJkKChkZXNrfi5wcmV2KShyKSwgbmV3X2spIGluCiAgICAgICgoKGRlc2suaXNzdWVkKSA9ICgoZGVza34uaXNzdWVkKSB1bmlvbiB7bmV3X2t9KSkgPT4KICAgICAgICAoKChkZXNrLnByZXYpID0gKChkZXNrfi5wcmV2KSArKyB7ciB8LT4gbmV3X2t9KSkgPT4KICAgICAgICAgIChub3QgKGcgaW4gc2V0IChkb20gZ3Vlc3RzfikpID0+CiAgICAgICAgICAgIGZvcmFsbCBsZG9tMSBpbiBzZXQgZG9tIGd1ZXN0c34sIHJkb20yIGluIHNldCBkb20ge2cgfC0+IHtuZXdfY319ICYKICAgICAgICAgICAgbGRvbTEgPSByZG9tMiA9PiBndWVzdHN+KGxkb20xKSA9IHtnIHwtPiB7bmV3X2N9fShyZG9tMikpKSkpKSkKLG1hcCBjb21wYXRpYmxlLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: Q2hlY2tJbiwwLChleGlzdHMgW25ld19rOktleV0gJiAoKG5ld19rIG5vdCBpbiBzZXQgKGRlc2t+Lmlzc3VlZCkpIGFuZCBsZXQgbmV3X2M6Q2FyZCA9IG1rX0NhcmQoKGRlc2t+LnByZXYpKHIpLCBuZXdfaykgaW4gKCgoZGVzay5pc3N1ZWQpID0gKChkZXNrfi5pc3N1ZWQpIHVuaW9uIHtuZXdfa30pKSBhbmQgKCgoZGVzay5wcmV2KSA9ICgoZGVza34ucHJldikgKysge3IgfC0+IG5ld19rfSkpIGFuZCAoaWYgKGcgaW4gc2V0IChkb20gZ3Vlc3RzfikpCnRoZW4gKGd1ZXN0cyA9IChndWVzdHN+ICsrIHtnIHwtPiAoZ3Vlc3RzfihnKSB1bmlvbiB7bmV3X2N9KX0pKQplbHNlIChndWVzdHMgPSAoZ3Vlc3RzfiBtdW5pb24ge2cgfC0+IHtuZXdfY319KSkpKSkpKQosb3BlcmF0aW9uIHBvc3QgY29uZGl0aW9uLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: Q2hlY2tJbiwwLChmb3JhbGwgZzpHdWVzdCwgcjpSb29tLCBvbGRzdGF0ZTpIb3RlbCAmCiAgcHJlX0NoZWNrSW4oZywgciwgb2xkc3RhdGUpID0+CiAgcG9zdF9DaGVja0luKGcsIHIsIG9sZHN0YXRlLCBuZXdzdGF0ZSkpCixvcGVyYXRpb24gc2F0aWZpYWJpbGl0eSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: RW50ZXIsMCwoKHIgaW4gc2V0IChkb20gbG9ja3MpKSA9PgogICgoZyBpbiBzZXQgKGRvbSBndWVzdHMpKSA9PgogICAgZyBpbiBzZXQgZG9tIGd1ZXN0cykpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXIsMCwoKHIgaW4gc2V0IChkb20gbG9ja3MpKSA9PgogICgoZyBpbiBzZXQgKGRvbSBndWVzdHMpKSA9PgogICAgKGZvcmFsbCBjIGluIHNldCBndWVzdHMoZykgJgogICAgICByIGluIHNldCBkb20gbG9ja3MpKSkKLG1hcCBhcHBseSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: RW50ZXIsMCwoKHIgaW4gc2V0IChkb20gbG9ja3MpKSA9PgogICgoZyBpbiBzZXQgKGRvbSBndWVzdHMpKSA9PgogICAgKGZvcmFsbCBjIGluIHNldCBndWVzdHMoZykgJgogICAgICAobm90ICgoYy5mc3QpID0gbG9ja3MocikpID0+CiAgICAgICAgciBpbiBzZXQgZG9tIGxvY2tzKSkpKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXIsMCxnIGluIHNldCBkb20gZ3Vlc3RzCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXIsMCwoZm9yYWxsIGMgaW4gc2V0IGd1ZXN0cyhnKSAmCiAgciBpbiBzZXQgZG9tIGxvY2tzKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXIsMCwoZm9yYWxsIGMgaW4gc2V0IGd1ZXN0cyhnKSAmCiAgKG5vdCAoKChjLmZzdCkgPSBsb2NrcyhyKSkgYW5kIChsb2NrcyA9IChsb2Nrc34gKysge3IgfC0+IChjLnNuZCl9KSkpID0+CiAgICByIGluIHNldCBkb20gbG9ja3MpKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXIsMCwoZXhpc3RzIFtjIGluIHNldCBndWVzdHMoZyldICYgKCgoKGMuZnN0KSA9IGxvY2tzKHIpKSBhbmQgKGxvY2tzID0gKGxvY2tzfiArKyB7ciB8LT4gKGMuc25kKX0pKSkgb3IgKCgoYy5zbmQpID0gbG9ja3MocikpIGFuZCAobG9ja3MgPSBsb2Nrc34pKSkpCixvcGVyYXRpb24gcG9zdCBjb25kaXRpb24sbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXIsMCwoZm9yYWxsIHI6Um9vbSwgZzpHdWVzdCwgb2xkc3RhdGU6SG90ZWwgJgogIHByZV9FbnRlcihyLCBnLCBvbGRzdGF0ZSkgPT4KICBwb3N0X0VudGVyKHIsIGcsIG9sZHN0YXRlLCBuZXdzdGF0ZSkpCixvcGVyYXRpb24gc2F0aWZpYWJpbGl0eSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCxleGlzdHMgbmV3X2s6S2V5ICYgKG5ld19rIG5vdCBpbiBzZXQgKGRlc2suaXNzdWVkKSkKLGxldCBiZSBzdCBleGlzdGVuY2UsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: Q2hlY2tJbkV4cGwsIG5ld19jLDAsciBpbiBzZXQgZG9tIChkZXNrLnByZXYpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCwtLSBBZnRlciBkZXNrLmlzc3VlZCA6PSAoKGRlc2suaXNzdWVkKSB1bmlvbiB7bmV3X2t9KQpsZXQgaCA9IEhvdGVsIGluICgoKGRvbSAoKGguZGVzaykucHJldikpIHN1YnNldCAoZG9tIChoLmxvY2tzKSkpIGFuZCAoKGR1bmlvbiB7eyhjLmZzdCksIChjLnNuZCl9IHwgW2MgaW4gc2V0IChkdW5pb24gKHJuZyAoaC5ndWVzdHMpKSldfSkgc3Vic2V0ICgoaC5kZXNrKS5pc3N1ZWQpKSkKLHN0YXRlIGludmFyaWFudCxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCwtLSBBZnRlciBkZXNrLnByZXYgOj0gKChkZXNrLnByZXYpICsrIHtyIHwtPiBuZXdfa30pCmxldCBoID0gSG90ZWwgaW4gKCgoZG9tICgoaC5kZXNrKS5wcmV2KSkgc3Vic2V0IChkb20gKGgubG9ja3MpKSkgYW5kICgoZHVuaW9uIHt7KGMuZnN0KSwgKGMuc25kKX0gfCBbYyBpbiBzZXQgKGR1bmlvbiAocm5nIChoLmd1ZXN0cykpKV19KSBzdWJzZXQgKChoLmRlc2spLmlzc3VlZCkpKQosc3RhdGUgaW52YXJpYW50LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCwtLSBBZnRlciBndWVzdHMgOj0gKGlmIChnIGluIHNldCAoZG9tIGd1ZXN0cykpCnRoZW4gKGd1ZXN0cyArKyB7ZyB8LT4gKGd1ZXN0cyhnKSB1bmlvbiB7bmV3X2N9KX0pCmVsc2UgKGd1ZXN0cyBtdW5pb24ge2cgfC0+IHtuZXdfY319KSkKbGV0IGggPSBIb3RlbCBpbiAoKChkb20gKChoLmRlc2spLnByZXYpKSBzdWJzZXQgKGRvbSAoaC5sb2NrcykpKSBhbmQgKChkdW5pb24ge3soYy5mc3QpLCAoYy5zbmQpfSB8IFtjIGluIHNldCAoZHVuaW9uIChybmcgKGguZ3Vlc3RzKSkpXX0pIHN1YnNldCAoKGguZGVzaykuaXNzdWVkKSkpCixzdGF0ZSBpbnZhcmlhbnQsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCwoKGcgaW4gc2V0IChkb20gZ3Vlc3RzKSkgPT4KICBnIGluIHNldCBkb20gZ3Vlc3RzKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: Q2hlY2tJbkV4cGwsMCwobm90IChnIGluIHNldCAoZG9tIGd1ZXN0cykpID0+CiAgZm9yYWxsIGxkb20xIGluIHNldCBkb20gZ3Vlc3RzLCByZG9tMiBpbiBzZXQgZG9tIHtnIHwtPiB7bmV3X2N9fSAmCiAgbGRvbTEgPSByZG9tMiA9PiBndWVzdHMobGRvbTEpID0ge2cgfC0+IHtuZXdfY319KHJkb20yKSkKLG1hcCBjb21wYXRpYmxlLG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXJFeHBsLDAsKChyIGluIHNldCAoZG9tIGxvY2tzKSkgPT4KICAoKGcgaW4gc2V0IChkb20gZ3Vlc3RzKSkgPT4KICAgIGcgaW4gc2V0IGRvbSBndWVzdHMpKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXJFeHBsLDAsKChyIGluIHNldCAoZG9tIGxvY2tzKSkgPT4KICAoKGcgaW4gc2V0IChkb20gZ3Vlc3RzKSkgPT4KICAgIChmb3JhbGwgYyBpbiBzZXQgZ3Vlc3RzKGcpICYKICAgICAgciBpbiBzZXQgZG9tIGxvY2tzKSkpCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXJFeHBsLDAsKChyIGluIHNldCAoZG9tIGxvY2tzKSkgPT4KICAoKGcgaW4gc2V0IChkb20gZ3Vlc3RzKSkgPT4KICAgIChmb3JhbGwgYyBpbiBzZXQgZ3Vlc3RzKGcpICYKICAgICAgKG5vdCAoKGMuZnN0KSA9IGxvY2tzKHIpKSA9PgogICAgICAgIHIgaW4gc2V0IGRvbSBsb2NrcykpKSkKLG1hcCBhcHBseSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: RW50ZXJFeHBsLDAsZXhpc3RzIGMgaW4gc2V0IGd1ZXN0cyhnKSAmICgoKGMuZnN0KSA9IGxvY2tzKHIpKSBvciAoKGMuc25kKSA9IGxvY2tzKHIpKSkKLGxldCBiZSBzdCBleGlzdGVuY2UsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXJFeHBsLDAsZyBpbiBzZXQgZG9tIGd1ZXN0cwosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs PROOFOBLIGATION: RW50ZXJFeHBsLDAsciBpbiBzZXQgZG9tIGxvY2tzCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXJFeHBsLDAsKG5vdCAoKGMuZnN0KSA9IGxvY2tzKHIpKSA9PgogIHIgaW4gc2V0IGRvbSBsb2NrcykKLG1hcCBhcHBseSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: RW50ZXJFeHBsLDAsciBpbiBzZXQgZG9tIGxvY2tzCixtYXAgYXBwbHksbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: RW50ZXJFeHBsLDAsLS0gQWZ0ZXIgbG9ja3MgOj0gKGxvY2tzICsrIHtyIHwtPiAoYy5zbmQpfSkKbGV0IGggPSBIb3RlbCBpbiAoKChkb20gKChoLmRlc2spLnByZXYpKSBzdWJzZXQgKGRvbSAoaC5sb2NrcykpKSBhbmQgKChkdW5pb24ge3soYy5mc3QpLCAoYy5zbmQpfSB8IFtjIGluIHNldCAoZHVuaW9uIChybmcgKGguZ3Vlc3RzKSkpXX0pIHN1YnNldCAoKGguZGVzaykuaXNzdWVkKSkpCixzdGF0ZSBpbnZhcmlhbnQsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: SXNzdWVDYXJkLDAsZXhpc3RzIGs6S2V5ICYgKGsgbm90IGluIHNldCAoZGVzay5pc3N1ZWQpKQosbGV0IGJlIHN0IGV4aXN0ZW5jZSxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: SXNzdWVDYXJkLDAsLS0gQWZ0ZXIgZGVzay5pc3N1ZWQgOj0gKChkZXNrLmlzc3VlZCkgdW5pb24ge2t9KQpsZXQgaCA9IEhvdGVsIGluICgoKGRvbSAoKGguZGVzaykucHJldikpIHN1YnNldCAoZG9tIChoLmxvY2tzKSkpIGFuZCAoKGR1bmlvbiB7eyhjLmZzdCksIChjLnNuZCl9IHwgW2MgaW4gc2V0IChkdW5pb24gKHJuZyAoaC5ndWVzdHMpKSldfSkgc3Vic2V0ICgoaC5kZXNrKS5pc3N1ZWQpKSkKLHN0YXRlIGludmFyaWFudCxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: QWRkUm9vbSwwLC0tIEFmdGVyIGRlc2sucHJldiA6PSAoKGRlc2sucHJldikgbXVuaW9uIHtyIHwtPiBrfSkKbGV0IGggPSBIb3RlbCBpbiAoKChkb20gKChoLmRlc2spLnByZXYpKSBzdWJzZXQgKGRvbSAoaC5sb2NrcykpKSBhbmQgKChkdW5pb24ge3soYy5mc3QpLCAoYy5zbmQpfSB8IFtjIGluIHNldCAoZHVuaW9uIChybmcgKGguZ3Vlc3RzKSkpXX0pIHN1YnNldCAoKGguZGVzaykuaXNzdWVkKSkpCixzdGF0ZSBpbnZhcmlhbnQsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: QWRkUm9vbSwwLGZvcmFsbCBsZG9tMSBpbiBzZXQgZG9tIChkZXNrLnByZXYpLCByZG9tMiBpbiBzZXQgZG9tIHtyIHwtPiBrfSAmCmxkb20xID0gcmRvbTIgPT4gKGRlc2sucHJldikobGRvbTEpID0ge3IgfC0+IGt9KHJkb20yKQosbWFwIGNvbXBhdGlibGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: QWRkUm9vbSwwLC0tIEFmdGVyIGxvY2tzIDo9IChsb2NrcyBtdW5pb24ge3IgfC0+IGt9KQpsZXQgaCA9IEhvdGVsIGluICgoKGRvbSAoKGguZGVzaykucHJldikpIHN1YnNldCAoZG9tIChoLmxvY2tzKSkpIGFuZCAoKGR1bmlvbiB7eyhjLmZzdCksIChjLnNuZCl9IHwgW2MgaW4gc2V0IChkdW5pb24gKHJuZyAoaC5ndWVzdHMpKSldfSkgc3Vic2V0ICgoaC5kZXNrKS5pc3N1ZWQpKSkKLHN0YXRlIGludmFyaWFudCxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: QWRkUm9vbSwwLGZvcmFsbCBsZG9tMSBpbiBzZXQgZG9tIGxvY2tzLCByZG9tMiBpbiBzZXQgZG9tIHtyIHwtPiBrfSAmCmxkb20xID0gcmRvbTIgPT4gbG9ja3MobGRvbTEpID0ge3IgfC0+IGt9KHJkb20yKQosbWFwIGNvbXBhdGlibGUsbnVsbCxVbnByb3ZlZCw= PROOFOBLIGATION: QWRkR3Vlc3QsMCwtLSBBZnRlciBndWVzdHMgOj0gKGd1ZXN0cyArKyB7ZyB8LT4gKGlmIChnIGluIHNldCAoZG9tIGd1ZXN0cykpCnRoZW4gKGd1ZXN0cyhnKSB1bmlvbiBjcykKZWxzZSBjcyl9KQpsZXQgaCA9IEhvdGVsIGluICgoKGRvbSAoKGguZGVzaykucHJldikpIHN1YnNldCAoZG9tIChoLmxvY2tzKSkpIGFuZCAoKGR1bmlvbiB7eyhjLmZzdCksIChjLnNuZCl9IHwgW2MgaW4gc2V0IChkdW5pb24gKHJuZyAoaC5ndWVzdHMpKSldfSkgc3Vic2V0ICgoaC5kZXNrKS5pc3N1ZWQpKSkKLHN0YXRlIGludmFyaWFudCxudWxsLFVucHJvdmVkLA== PROOFOBLIGATION: QWRkR3Vlc3QsMCwoKGcgaW4gc2V0IChkb20gZ3Vlc3RzKSkgPT4KICBnIGluIHNldCBkb20gZ3Vlc3RzKQosbWFwIGFwcGx5LG51bGwsVW5wcm92ZWQs


--hotel.vdmsl

types 

Key = token;
Room = token;
Guest = token;

Card :: fst : Key
        snd : Key; 

Desk :: issued : set of Key
        prev   : map Room to Key
inv d == rng d.prev subset d.issued; 

state Hotel of 
        desk   : Desk
        locks  : map Room to Key
        guests : map Guest to set of Card

inv h == dom h.desk.prev subset dom h.locks and
         dunion {{c.fst, c.snd} | c in set dunion rng h.guests}
         subset h.desk.issued

init h == h.desk.issued = {} and 
          h.desk.prev = h.locks and 
          rng h.guests = {{}}

end

operations

CheckIn(g:Guest,r:Room)

ext wr desk   : Desk
    wr guests : map Guest to set of Card

pre r in set dom desk.prev

post exists new_k:Key &
	new_k not in set desk~.issued            and 
 	let new_c = mk_Card(desk~.prev(r),new_k)
        in
	desk.issued = desk~.issued union {new_k} and 
	desk.prev = desk~.prev ++ {r |-> new_k}  and 
	if g in set dom guests~
	then guests = guests~ ++ {g |-> guests~(g) union {new_c}}
    else guests = guests~ munion {g |-> {new_c}};


Enter(r:Room,g:Guest)

ext wr locks  : map Room to Key
    rd guests : map Guest to set of Card

pre r in set dom locks  and 
    g in set dom guests and
    exists c in set guests(g) & c.fst=locks(r) or c.snd=locks(r) 

post exists c in set guests(g) & 
	c.fst = locks(r) and locks = locks~ ++ {r |-> c.snd} or
	c.snd = locks(r) and locks = locks~;

CheckInExpl: Guest * Room ==> ()
CheckInExpl(g,r) ==
  let new_k:Key be st new_k not in set desk.issued
  in 
    let new_c = mk_Card(desk.prev(r),new_k)
    in
      (desk.issued := desk.issued union {new_k}; 
       desk.prev   := desk.prev ++ {r |-> new_k}; 
       guests      := if g in set dom guests
	                  then guests ++ {g |-> guests(g) union {new_c}}
                      else guests munion {g |-> {new_c}}
      )
pre r in set dom desk.prev;

--
-- Explicit versions of operations for execution on the interpreter
--

EnterExpl: Room * Guest ==> ()
EnterExpl(r,g) ==
  let c in set guests(g) be st c.fst = locks(r) or c.snd = locks(r)
  in
    if c.fst = locks(r)
    then locks := locks ++ {r |-> c.snd}
pre r in set dom locks  and 
    g in set dom guests and
    exists c in set guests(g) & c.fst=locks(r) or c.snd=locks(r); 

IssueCard: () ==> Key
IssueCard() ==
  let k: Key be st k not in set desk.issued
  in
    (desk.issued := desk.issued union {k};
     return k
    );

AddRoom: Room * Key ==> ()
AddRoom(r,k) ==
  (desk.prev := desk.prev munion {r |-> k};
   locks := locks munion {r |-> k}
  )
pre k in set desk.issued and r not in set dom locks;

AddGuest: Guest * set of Card ==> ()
AddGuest(g,cs) ==
  guests := guests ++ {g |-> if g in set dom guests
                             then guests(g) union cs
                             else cs}
pre forall c in set cs & {c.fst, c.snd} subset desk.issued;