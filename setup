#!/bin/sh
# Make of Overture

# install function
install()
{
echo "Installing..."
echo "    Each step might take a minute or two to complete"
echo "Making Overture - Core ..."

cd core

mvn install -Dmaven.test.skip=true > /tmp/overtureInstall.log

if test $? -gt 0  
then
echo "Could not install core components"
cd ..
exit 1;
fi

cd ..


echo "Making Overture - Eclipse Projects (eclipse:eclipse)..."

mvn eclipse:eclipse >> /tmp/overtureInstall.log

if test $? -gt 0  
then
echo "Could not create eclipse projects. Do not attempt to import before eclipse:eclipse has been executed. (If not there will be failures in the eclipse projects so dependencies will be imposible to resolv"
exit 1;
fi


echo "Making Overture - Updating Generated plugins..."

echo "Updating generated core components of the IDE..."

cd ide/generated
mvn psteclipse:eclipse-plugin >> /tmp/overtureInstall.log

if test $? -gt 0  
then
echo "The core components could not be wrapped into eclipse plugins. The Editor will not be able to compile but the core components are avaliable"
cd ..
cd ..
exit 1;
fi
cd ..
cd ..

echo "Making Overture - Ready to Eclise import as Maven Projects"


echo
echo "Now you can import (Maven Projects) the IDE module in eclipse and develop new stuff here. Remember to update classpath on the manifest in org.overture.ide.generated.* packages";
echo


}


#clean
clean()
{

echo "Clean Overture - Core..."
cd core
mvn clean -o > /tmp/overtureInstall.log
if test $? -gt 0  
then
echo "Could not clean core"
exit;
fi
cd ..

echo "Clean Overture - Eclipse Projects (eclipse:clean)..."

mvn eclipse:eclean -o >> /tmp/overtureInstall.log

if test $? -gt 0  
then
echo "Could not clean all eclipse related files"
exit;
fi
}

testMaven()
{
echo "Looking for Maven in path..."
mvn -version > /tmp/overtureInstall.log

if test $? -gt 0  
then
echo "Maven is not in the path"
exit 1;
fi
echo "Maven found"
}


if test $# -lt 1  
then
echo "Overture development setup"
echo "	Install: Prepare all sources for development"
echo "	Clean  : Clean all autogenerated source"
exit;
fi



testMaven
while [ ! -z "$1" ]; do
case $1 in
    install)
install
;;
clean)
clean
;;

esac
shift
done

echo "Standard out written to: /tmp/overtureInstall.log"
